---
title: "cumulative flux plots"
author: "Dani Trangmoe"
date: "`r Sys.Date()`"
output: html_document
---


```{r}

rm(list = ls())
Sys.setenv(TZ = "UTC")

library(data.table)
library(ggplot2)
library(lubridate)
library(tidyverse)
library(gridExtra) 
library(patchwork)
library(plotrix) # standard error function

```

Load Dataframe
```{r}

df_avg_23_24 <- fread('./output_files/three_years_daily_avg.csv')
df_23_24 <- fread("./output_files/three_years_HH.csv")

```

# Create sequential DAY within seasonal groupings

```{r}

df_23_24 <- df_23_24 %>%
  mutate(date = as.Date(TIMESTAMP)) %>%
  group_by(full_year) %>%
  mutate(
    DOSY = as.integer(date - min(date)) + 1
  ) %>%
  ungroup()


df_23_24 <- df_23_24 %>%
  arrange(full_year, DOSY) %>%
  group_by(full_year) %>%
  mutate(
    cumulative_co2 = cumsum(FC_F * 60 * (1/1e6) * 12 * 30)
  ) %>%
  mutate(
    cumulative_ch4 = cumsum(FCH4_F * 60 * (1/1e9) * 12 * 30)
  ) %>%
  ungroup()


# Fix spring thaw name change

df_23_24$season_name <- ifelse(df_23_24$season_name== "Snow Melt", "Spring Thaw", df_23_24$season_name)

```


Plot
```{r}

ggplot(data = df_23_24)+
  geom_point(aes(DOSY, cumulative_co2, color = season_name))+
  geom_hline(yintercept = 0)+
  scale_color_manual(name = NULL,
            values = c("Spring Thaw" = "mediumorchid",
                      "Fall Senescence" = "orange",
                      "Winter" = "turquoise3",
                      "Growing Season" = "green4"),
            breaks = c("Fall Senescence", "Winter", "Spring Thaw", "Growing Season"))+
  labs(
    y = expression("Cumulative NEE (gC"~m^-2~y^-1*")"),
    x = expression("Day of seasonal year (??)")
  )

ggplot(data = df_23_24)+
  geom_point(aes(DOSY, cumulative_ch4, color = season_name))+
  geom_hline(yintercept = 0)+
  scale_color_manual(name = NULL,
            values = c("Spring Thaw" = "mediumorchid",
                      "Fall Senescence" = "orange",
                      "Winter" = "turquoise3",
                      "Growing Season" = "green4"),
            breaks = c("Fall Senescence", "Winter", "Spring Thaw", "Growing Season"))+
  labs(
    y = expression("Cumulative CH4 Flux (gC"~m^-2~y^-1*")"),
    x = expression("Day of seasonal year (??)")
  )


```




